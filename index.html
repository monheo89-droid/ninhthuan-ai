<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninh Thu·∫≠n AI - Tour & Digital Shop</title>
    <style>
        :root { --primary: #ff9800; --success: #27ae60; --dark: #2c3e50; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #000; }

        /* --- L·ªõp ph·ªß Video Gi·ªõi thi·ªáu --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 5000; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        #intro-video { width: 100%; max-height: 80vh; background: #000; }
        .skip-btn {
            margin-top: 20px; padding: 12px 30px; background: var(--primary);
            color: white; border: none; border-radius: 30px; cursor: pointer; font-weight: bold;
        }

        /* --- H·ªá th·ªëng Tab --- */
        .tab-content { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .tab-content.active { display: block; }
        iframe { width: 100%; height: 100%; border: none; }

        /* --- Thanh ƒëi·ªÅu h∆∞·ªõng c·ªë ƒë·ªãnh --- */
        .nav-bar { position: absolute; top: 20px; left: 20px; z-index: 4000; display: flex; gap: 10px; }
        .nav-btn { 
            width: 48px; height: 48px; border-radius: 50%; border: none; 
            background: white; color: var(--dark); font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; 
            transition: 0.3s;
        }
        .nav-btn.active-tab { background: var(--primary); color: white; transform: scale(1.1); }
        .nav-btn.cart-btn.active-tab { background: var(--success); }

        /* --- Menu AI & Canvas --- */
        #ai-menu-panel { 
            position: absolute; top: 85px; left: 20px; z-index: 3000; width: 280px; 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); 
            padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: 0.3s ease-out;
        }
        #ai-menu-panel.hidden { transform: scale(0); opacity: 0; pointer-events: none; }
        #ui-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 500; pointer-events: none; }
        
        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; color: white; font-size: 14px; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 6000; display: none; color: white; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <video id="intro-video" autoplay muted playsinline>
            <source src="LINK_VIDEO_INTRO_CUA_BAN.mp4" type="video/mp4">
        </video>
        <button class="skip-btn" onclick="closeIntro()">B·∫ÆT ƒê·∫¶U TR·∫¢I NGHI·ªÜM ‚Üí</button>
    </div>

    <div id="loading">‚ôªÔ∏è AI ƒêANG X·ª¨ L√ù...</div>

    <div class="nav-bar">
        <button class="nav-btn" onclick="toggleMenu()" title="Menu">‚ò∞</button>
        <button class="nav-btn active-tab" id="btn-vr" onclick="switchTab('vr-tab')">üìç</button>
        <button class="nav-btn cart-btn" id="btn-shop" onclick="switchTab('shop-tab')">üõí</button>
    </div>

    <div id="vr-tab" class="tab-content active">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
        <canvas id="ui-canvas"></canvas>

        <div id="ai-menu-panel">
            <h3 style="margin:0 0 10px 0">Ninh Thu·∫≠n AI</h3>
            <label class="btn-action" style="display:block; text-align:center; background:var(--primary)">
                üì∏ T·∫£i ·∫£nh ng∆∞·ªùi
                <input type="file" id="input-file" style="display:none" onchange="processAI(this)">
            </label>

            <div id="edit-controls" style="display:none; margin-top:15px;">
                <input type="range" id="size-slider" min="0.1" max="2.5" step="0.1" value="1.0" style="width:100%">
                <button class="btn-action" style="background:var(--success)" onclick="startCapture()">üéÅ Xu·∫•t b∆∞u thi·∫øp</button>
            </div>
        </div>
    </div>

    <div id="shop-tab" class="tab-content">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
    </div>

    <script>
        const API_KEY = "FtyKLHXkG5By3gFBCBcoTACC";
        const canvas = document.getElementById('ui-canvas');
        const ctx = canvas.getContext('2d');
        let userImg = null, imgPos = { x: 100, y: 100, w: 0, h: 0 };

        window.onload = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };

        // X·ª≠ l√Ω t·∫Øt Video Intro ƒë·ªÉ tr√°nh ƒë∆° n√∫t
        function closeIntro() {
            const video = document.getElementById('intro-video');
            video.pause(); // D·ª´ng video ngay l·∫≠p t·ª©c
            document.getElementById('intro-overlay').style.display = 'none';
        }

        // Chuy·ªÉn Tab th√¥ng minh
        function switchTab(tabId) {
            closeIntro(); // ƒê·∫£m b·∫£o video b·ªã d·∫πp b·ªè khi nh·∫•n n√∫t

            // ·∫®n/Hi·ªán Tab
            document.getElementById('vr-tab').classList.remove('active');
            document.getElementById('shop-tab').classList.remove('active');
            document.getElementById(tabId).classList.add('active');

            // C·∫≠p nh·∫≠t n√∫t
            document.getElementById('btn-vr').classList.remove('active-tab');
            document.getElementById('btn-shop').classList.remove('active-tab');

            if(tabId === 'vr-tab') {
                document.getElementById('btn-vr').classList.add('active-tab');
                document.getElementById('ai-menu-panel').style.display = "block";
                canvas.style.display = "block";
            } else {
                document.getElementById('btn-shop').classList.add('active-tab');
                document.getElementById('ai-menu-panel').style.display = "none";
                canvas.style.display = "none";
            }
        }

        function toggleMenu() { document.getElementById('ai-menu-panel').classList.toggle('hidden'); }

        // Logic AI T√°ch n·ªÅn
        async function processAI(input) {
            if (!input.files[0]) return;
            document.getElementById('loading').style.display = "flex";
            const formData = new FormData();
            formData.append("image_file", input.files[0]);
            try {
                const res = await fetch("https://api.remove.bg/v1.0/removebg", {
                    method: "POST", headers: { "X-Api-Key": API_KEY }, body: formData
                });
                const blob = await res.blob();
                userImg = new Image();
                userImg.onload = () => {
                    const ratio = userImg.width / userImg.height;
                    imgPos.w = 400 * ratio; imgPos.h = 400;
                    document.getElementById('loading').style.display = "none";
                    document.getElementById('edit-controls').style.display = "block";
                    render();
                };
                userImg.src = URL.createObjectURL(blob);
            } catch (e) { alert("L·ªói k·∫øt n·ªëi AI!"); document.getElementById('loading').style.display = "none"; }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (userImg) {
                const s = document.getElementById('size-slider').value;
                ctx.drawImage(userImg, imgPos.x, imgPos.y, imgPos.w * s, imgPos.h * s);
            }
        }
        document.getElementById('size-slider').oninput = render;

        function startCapture() {
            alert("ƒêang chu·∫©n b·ªã xu·∫•t b∆∞u thi·∫øp...");
            // G·∫Øn logic ch·ª•p m√†n h√¨nh c·ªßa b·∫°n v√†o ƒë√¢y
        }
    </script>
</body>
</html>
