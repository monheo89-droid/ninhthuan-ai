<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninh Thu·∫≠n AI - Gian H√†ng S·ªë N√¢ng C·∫•p</title>
    <style>
        :root { --shopee: #ee4d2d; --accent: #ff9800; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }

        /* L·ªöP 1: PANOEE G·ªêC (GI·ªÆ NGUY√äN) */
        #main-tour {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: none; z-index: 1;
        }

        /* L·ªöP 2: N√öT GI·ªé H√ÄNG N·ªîI (T√çNH NƒÇNG TH√äM) */
        .shop-trigger {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            width: 50px; height: 50px; background: var(--shopee); color: white;
            border: none; border-radius: 50%; cursor: pointer; font-size: 22px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
        }

        /* L·ªöP 3: C·ª¨A S·ªî GIAN H√ÄNG (CH·ªà HI·ªÜN KHI C·∫¶N) */
        #shop-panel {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%;
            background: #fff; z-index: 1000; transition: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: -5px 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column;
        }
        #shop-panel.open { right: 0; }
        
        .header { background: var(--shopee); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .product-list { flex: 1; overflow-y: auto; padding: 15px; background: #f8f8f8; }
        
        /* CARD S·∫¢N PH·∫®M */
        .item {
            background: #fff; border-radius: 10px; padding: 12px; margin-bottom: 15px;
            display: flex; gap: 15px; align-items: center; border: 2px solid transparent;
        }
        .item.focus { border-color: var(--shopee); background: #fff5f2; }
        .item img { width: 85px; height: 85px; object-fit: cover; border-radius: 8px; }
        .item-info { flex: 1; }
        .item-info h4 { margin: 0 0 5px 0; font-size: 15px; }
        .price { color: var(--shopee); font-weight: bold; font-size: 17px; }
        .buy-now { 
            background: var(--shopee); color: white; border: none; padding: 8px; 
            border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold;
        }

        #overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none;
        }
    </style>
</head>
<body>

    <iframe id="main-tour" src="https://tour.panoee.net/68972f4ba3c49352552578cd/691b32dc061521c90def58cb"></iframe>

    <button class="shop-trigger" onclick="toggleShop()">üõí</button>

    <div id="overlay" onclick="toggleShop()"></div>

    <div id="shop-panel">
        <div class="header">
            <h3 style="margin:0">Gian H√†ng ƒê·∫∑c S·∫£n</h3>
            <button onclick="toggleShop()" style="background:none; border:none; color:white; font-size:30px; cursor:pointer;">&times;</button>
        </div>
        <div class="product-list" id="list-container">
            <p style="text-align:center; padding-top:50px; color:#888;">ƒêang k·∫øt n·ªëi d·ªØ li·ªáu...</p>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbyD5o6YcsMgL1Qw-tupdqER9EuwnZrCY1qEkWn30MWbmaqe1xFGjrKSE8bkIlkFZkpV/exec";
        const PHONE = "0909559101";

        // L·∫ÆNG NGHE L·ªÜNH T·ª™ PANOEE (KH√îNG CAN THI·ªÜP PANOEE)
        // Trong Panoee, b·∫°n ch·ªâ c·∫ßn ƒë·∫∑t Hotspot URL l√†: javascript:window.parent.openFromTour('ID')
        window.openFromTour = function(id) {
            toggleShop(true, id);
        };

        async function toggleShop(show = null, focusId = null) {
            const panel = document.getElementById('shop-panel');
            const overlay = document.getElementById('overlay');
            const isOpening = show !== null ? show : !panel.classList.contains('open');

            if (isOpening) {
                panel.classList.add('open');
                overlay.style.display = 'block';
                await loadProducts(focusId);
            } else {
                panel.classList.remove('open');
                overlay.style.display = 'none';
            }
        }

        async function loadProducts(focusId) {
            const container = document.getElementById('list-container');
            try {
                const res = await fetch(API);
                const data = await res.json();
                
                container.innerHTML = data.map(p => `
                    <div class="item ${focusId == p.id ? 'focus' : ''}" id="p-${p.id}">
                        <img src="${p.image}" onerror="this.src='https://via.placeholder.com/80'">
                        <div class="item-info">
                            <h4>${p.name}</h4>
                            <div class="price">${Number(p.price).toLocaleString()}ƒë</div>
                            <button class="buy-now" onclick="toZalo('${p.name}')">ƒê·∫∂T MUA</button>
                        </div>
                    </div>
                `).join('');

                if (focusId) {
                    setTimeout(() => {
                        document.getElementById('p-' + focusId)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            } catch (e) {
                container.innerHTML = "Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.";
            }
        }

        function toZalo(name) {
            const msg = encodeURIComponent(`Ch√†o b·∫°n, m√¨nh mu·ªën mua: ${name}`);
            window.open(`https://zalo.me/${PHONE}?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
