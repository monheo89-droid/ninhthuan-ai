<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninh Thu·∫≠n Digital Eco-System</title>
    <style>
        :root { --primary: #ff9800; --success: #27ae60; --dark: #2c3e50; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', sans-serif; overflow: hidden; background: #000; }

        /* --- Qu·∫£n l√Ω Tab --- */
        .tab-content { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        .tab-content.active { display: block; }

        /* --- N√∫t ƒëi·ªÅu h∆∞·ªõng n·ªïi --- */
        .nav-container { position: absolute; top: 20px; left: 20px; z-index: 1000; display: flex; gap: 12px; }
        .nav-btn { 
            width: 50px; height: 50px; border-radius: 50%; border: none; 
            background: white; color: var(--dark); font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; 
            transition: 0.3s; 
        }
        .nav-btn.active-tab { background: var(--primary); color: white; }
        .nav-btn.cart-btn.active-tab { background: var(--success); }

        /* --- Th√†nh ph·∫ßn VR --- */
        iframe { width: 100%; height: 100%; border: none; }
        #ui-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; pointer-events: none; }

        /* --- Menu AI (Ch·ªâ hi·ªán ·ªü Tab VR) --- */
        .ai-panel { 
            position: absolute; top: 85px; left: 20px; z-index: 500; width: 260px; 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); 
            padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            transition: 0.4s;
        }
        .ai-panel.hidden { transform: scale(0); opacity: 0; pointer-events: none; }

        .btn-action { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #guide-frame { position: absolute; top: 15vh; left: 55vw; width: 320px; height: 450px; border: 2px dashed #fff; z-index: 50; pointer-events: none; border-radius: 12px; display:none; }
        
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
    </style>
</head>
<body>

    <div id="loading">‚ôªÔ∏è AI ƒêANG T√ÅCH N·ªÄN...</div>

    <div class="nav-container">
        <button class="nav-btn active-tab" id="btn-vr" onclick="switchTab('vr-tab')" title="Tour C·∫£nh ƒê·∫πp">üìç</button>
        <button class="nav-btn cart-btn" id="btn-shop" onclick="switchTab('shop-tab')" title="Gian H√†ng S·ªë">üõí</button>
    </div>

    <div id="vr-tab" class="tab-content active">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
        <canvas id="ui-canvas"></canvas>
        <div id="guide-frame"></div>
        
        <div class="ai-panel" id="ai-menu">
            <h3 style="margin:0 0 10px; font-size: 16px;">Ninh Thu·∫≠n AI</h3>
            <label class="btn-action" style="display:block; text-align:center;">
                üì∏ T·∫£i ·∫£nh ng∆∞·ªùi
                <input type="file" id="input-file" style="display:none" onchange="initAI(this)">
            </label>
            <div id="edit-controls" style="display:none; margin-top:15px;">
                <input type="range" id="size-slider" min="0.5" max="2" step="0.1" value="1" style="width:100%">
                <button class="btn-action" style="background:var(--success)" onclick="startCapture()">üéÅ Xu·∫•t b∆∞u thi·∫øp</button>
            </div>
        </div>
    </div>

    <div id="shop-tab" class="tab-content">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
    </div>

    <script>
        const API_KEY = "FtyKLHXkG5By3gFBCBcoTACC";
        const canvas = document.getElementById('ui-canvas');
        const ctx = canvas.getContext('2d');
        let userImg = null, imgPos = { x: 0, y: 0, w: 0, h: 0 };

        window.onload = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };

        // LOGIC CHUY·ªÇN TAB
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));

            document.getElementById(tabId).classList.add('active');
            
            if(tabId === 'vr-tab') {
                document.getElementById('btn-vr').classList.add('active-tab');
            } else {
                document.getElementById('btn-shop').classList.add('active-tab');
            }
        }

        // LOGIC AI (Gi·ªØ nguy√™n t·ª´ b·∫£n ch·∫°y t·ªët c·ªßa b·∫°n)
        async function initAI(input) {
            if (!input.files[0]) return;
            document.getElementById('loading').style.display = "flex";
            const formData = new FormData();
            formData.append("image_file", input.files[0]);
            try {
                const res = await fetch("https://api.remove.bg/v1.0/removebg", { method: "POST", headers: { "X-Api-Key": API_KEY }, body: formData });
                const blob = await res.blob();
                userImg = new Image();
                userImg.onload = () => {
                    const ratio = userImg.width / userImg.height;
                    imgPos.h = 450; imgPos.w = 450 * ratio;
                    imgPos.x = window.innerWidth / 2 - imgPos.w / 2;
                    imgPos.y = window.innerHeight / 2 - imgPos.h / 2;
                    document.getElementById('loading').style.display = "none";
                    document.getElementById('edit-controls').style.display = "block";
                    document.getElementById('guide-frame').style.display = "block";
                    render();
                };
                userImg.src = URL.createObjectURL(blob);
            } catch (e) { alert("L·ªói AI!"); document.getElementById('loading').style.display="none"; }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (userImg) {
                const s = document.getElementById('size-slider').value;
                ctx.drawImage(userImg, imgPos.x, imgPos.y, imgPos.w * s, imgPos.h * s);
            }
        }
        document.getElementById('size-slider').oninput = render;

        // Th√™m h√†m startCapture() c·ªßa b·∫°n v√†o ƒë√¢y ƒë·ªÉ ho√†n thi·ªán...
    </script>
</body>
</html>
