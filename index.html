<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninh Thu·∫≠n AI - Tour & Shop</title>
    <style>
        :root { --primary: #ff9800; --success: #27ae60; --dark: #2c3e50; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #000; }

        /* --- Qu·∫£n l√Ω hi·ªÉn th·ªã Tab --- */
        .tab-content { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        .tab-content.active { display: block; }
        iframe { width: 100%; height: 100%; border: none; position: absolute; }

        /* --- Thanh ƒëi·ªÅu h∆∞·ªõng (Lu√¥n hi·ªán) --- */
        .nav-bar { position: absolute; top: 20px; left: 20px; z-index: 2000; display: flex; gap: 10px; }
        .nav-btn { 
            width: 45px; height: 45px; border-radius: 50%; border: none; 
            background: white; color: var(--dark); font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; 
            transition: 0.3s;
        }
        .nav-btn.active-tab { background: var(--primary); color: white; }
        .nav-btn.cart-btn.active-tab { background: var(--success); }

        /* --- Menu AI (Ch·ªâ hi·ªán ·ªü Tab 1) --- */
        #ai-menu-panel { 
            position: absolute; top: 75px; left: 20px; z-index: 1000; width: 280px; 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); 
            padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: 0.3s; transform-origin: top left;
        }
        #ai-menu-panel.hidden { transform: scale(0); opacity: 0; pointer-events: none; }

        /* --- C√°c n√∫t l·ªánh trong Menu --- */
        .btn-main { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; color: white; }
        .btn-upload { background: var(--primary); }
        .btn-capture { background: var(--success); }

        /* --- Canvas ng∆∞·ªùi --- */
        #ui-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 500; pointer-events: none; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; display: none; color: white; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="loading">‚ôªÔ∏è ƒêANG T√ÅCH N·ªÄN AI...</div>

    <div class="nav-bar">
        <button class="nav-btn" id="btn-toggle" onclick="toggleMenu()" title="·∫®n/Hi·ªán Menu">‚ò∞</button>
        <button class="nav-btn active-tab" id="btn-vr" onclick="switchTab('vr-tab')" title="Tour Du L·ªãch">üìç</button>
        <button class="nav-btn cart-btn" id="btn-shop" onclick="switchTab('shop-tab')" title="Gian H√†ng S·ªë">üõí</button>
    </div>

    <div id="vr-tab" class="tab-content active">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
        
        <canvas id="ui-canvas"></canvas>

        <div id="ai-menu-panel">
            <h3 style="margin-top:0">Ninh Thu·∫≠n AI</h3>
            <label class="btn-main btn-upload" style="display:block; text-align:center;">
                üì∏ T·∫£i ·∫£nh ng∆∞·ªùi
                <input type="file" id="input-file" style="display:none" onchange="processAI(this)">
            </label>

            <div id="capture-tools" style="display:none; margin-top:15px;">
                <p style="font-size:12px; margin-bottom:5px;">Ph√≥ng to/nh·ªè:</p>
                <input type="range" id="size-slider" min="0.1" max="2.5" step="0.1" value="1.0" style="width:100%">
                <button class="btn-main btn-capture" onclick="alert('B·∫Øt ƒë·∫ßu ch·ª•p ·∫£nh...')">üéÅ Xu·∫•t b∆∞u thi·∫øp</button>
            </div>
        </div>
    </div>

    <div id="shop-tab" class="tab-content">
        <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
    </div>

    <script>
        const API_KEY = "FtyKLHXkG5By3gFBCBcoTACC";
        const canvas = document.getElementById('ui-canvas');
        const ctx = canvas.getContext('2d');
        let userImg = null, imgPos = { x: 100, y: 100, w: 0, h: 0 };

        window.onload = () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        };

        // H√†m ·∫©n/hi·ªán Menu ‚ò∞
        function toggleMenu() {
            const panel = document.getElementById('ai-menu-panel');
            panel.classList.toggle('hidden');
        }

        // H√†m chuy·ªÉn ƒë·ªïi TAB üìç vs üõí
        function switchTab(tabId) {
            // ·∫®n t·∫•t c·∫£
            document.getElementById('vr-tab').classList.remove('active');
            document.getElementById('shop-tab').classList.remove('active');
            document.getElementById('btn-vr').classList.remove('active-tab');
            document.getElementById('btn-shop').classList.remove('active-tab');

            // Hi·ªán Tab ƒë∆∞·ª£c ch·ªçn
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'vr-tab') {
                document.getElementById('btn-vr').classList.add('active-tab');
                document.getElementById('ai-menu-panel').style.display = 'block';
                canvas.style.display = 'block';
            } else {
                document.getElementById('btn-shop').classList.add('active-tab');
                document.getElementById('ai-menu-panel').style.display = 'none';
                canvas.style.display = 'none';
            }
        }

        // H√†m x·ª≠ l√Ω AI t√°ch n·ªÅn
        async function processAI(input) {
            if (!input.files[0]) return;
            document.getElementById('loading').style.display = "flex";
            const formData = new FormData();
            formData.append("image_file", input.files[0]);
            
            try {
                const res = await fetch("https://api.remove.bg/v1.0/removebg", {
                    method: "POST", headers: { "X-Api-Key": API_KEY }, body: formData
                });
                const blob = await res.blob();
                userImg = new Image();
                userImg.onload = () => {
                    const ratio = userImg.width / userImg.height;
                    imgPos.w = 400 * ratio; imgPos.h = 400;
                    document.getElementById('loading').style.display = "none";
                    document.getElementById('capture-tools').style.display = "block";
                    render();
                };
                userImg.src = URL.createObjectURL(blob);
            } catch (e) {
                alert("L·ªói AI!");
                document.getElementById('loading').style.display = "none";
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (userImg) {
                const s = document.getElementById('size-slider').value;
                ctx.drawImage(userImg, imgPos.x, imgPos.y, imgPos.w * s, imgPos.h * s);
            }
        }
        document.getElementById('size-slider').oninput = render;
    </script>
</body>
</html>
