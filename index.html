<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninh Thu·∫≠n AI - Smart Ecommerce</title>
    <style>
        :root { 
            --primary: #ff9800; 
            --success: #27ae60;
            --shopee: #ee4d2d;
            --glass: rgba(255, 255, 255, 0.95);
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #000; }

        /* --- IFRAME LAYERS --- */
        .pano-page { position: absolute; inset: 0; visibility: hidden; z-index: 1; }
        .pano-page.active { visibility: visible; z-index: 10; }
        iframe { width: 100%; height: 100%; border: none; }

        /* --- NAVIGATION --- */
        .top-btns { position: absolute; top: 20px; left: 20px; z-index: 10000; display: flex; gap: 12px; }
        .round-btn {
            width: 50px; height: 50px; background: var(--primary); color: white;
            border: none; border-radius: 50%; cursor: pointer; font-size: 22px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .round-btn.cart-btn { background: var(--shopee); }
        .round-btn.active { outline: 3px solid white; transform: scale(1.1); }

        /* --- SMART SHOP POPUP --- */
        #shop-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); 
            z-index: 10001; display: none; backdrop-filter: blur(5px); 
        }
        #shop-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 400px; background: #f5f5f5; border-radius: 20px;
            overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .shop-header { background: var(--shopee); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .shop-content { padding: 15px; max-height: 450px; overflow-y: auto; }

        /* PRODUCT CARD STYLE */
        .product-card {
            background: white; border-radius: 12px; display: flex; gap: 12px;
            padding: 10px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .product-card img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; background: #eee; }
        .product-info { flex: 1; }
        .product-info h4 { margin: 0 0 5px 0; font-size: 15px; }
        .product-info .price { color: var(--shopee); font-weight: bold; font-size: 16px; margin-bottom: 8px; }
        .buy-btn { 
            background: var(--shopee); color: white; border: none; 
            padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;
            text-decoration: none; display: inline-block;
        }

        /* LOADING INDICATOR */
        #shop-loader { text-align: center; padding: 20px; display: none; }
        .spinner { width: 30px; height: 30px; border: 3px solid #ddd; border-top-color: var(--shopee); border-radius: 50%; animation: spin 0.8s linear infinite; margin: auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="top-btns">
    <button class="round-btn active" id="btn-vr" onclick="switchTab('vr')">üìç</button>
    <button class="round-btn cart-btn" id="btn-shop" onclick="openShop()">üõí</button>
</div>

<div id="page-vr" class="pano-page active">
    <iframe src="https://tour.panoee.net/68972f4ba3c49352552578cd/68c2e05f65c1d76691a79f7c"></iframe>
</div>

<div id="shop-overlay" onclick="closeShop(event)">
    <div id="shop-container">
        <div class="shop-header">
            <h3 style="margin:0">ƒê·∫∑c S·∫£n Ninh Thu·∫≠n</h3>
            <span style="cursor:pointer; font-size: 24px;" onclick="document.getElementById('shop-overlay').style.display='none'">&times;</span>
        </div>
        
        <div id="shop-loader">
            <div class="spinner"></div>
            <p style="color:#666; font-size:13px; margin-top:10px;">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Sheets...</p>
        </div>

        <div class="shop-content" id="product-list">
            </div>
    </div>
</div>

<script>
    // ƒê∆Ø·ªúNG LINK API C·ª¶A B·∫†N
    const SHEET_API = "https://script.google.com/macros/s/AKfycbyD5o6YcsMgL1Qw-tupdqER9EuwnZrCY1qEkWn30MWbmaqe1xFGjrKSE8bkIlkFZkpV/exec";

    function switchTab(tab) {
        document.querySelectorAll('.pano-page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + tab).classList.add('active');
        document.getElementById('btn-vr').classList.toggle('active', tab === 'vr');
    }

    async function openShop() {
        document.getElementById('shop-overlay').style.display = 'block';
        const listContainer = document.getElementById('product-list');
        const loader = document.getElementById('shop-loader');
        
        // Hi·ªán hi·ªáu ·ª©ng t·∫£i
        listContainer.innerHTML = "";
        loader.style.display = 'block';

        try {
            const response = await fetch(SHEET_API);
            const products = await response.json();
            
            loader.style.display = 'none';
            
            if (products.length === 0) {
                listContainer.innerHTML = "<p style='text-align:center; color:#999;'>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</p>";
                return;
            }

            // ƒê·ªï d·ªØ li·ªáu v√†o giao di·ªán
            products.forEach(p => {
                const priceFormatted = Number(p.price).toLocaleString('vi-VN');
                listContainer.innerHTML += `
                    <div class="product-card">
                        <img src="${p.image || 'https://via.placeholder.com/80'}" alt="${p.name}">
                        <div class="product-info">
                            <h4>${p.name}</h4>
                            <div class="price">${priceFormatted}ƒë</div>
                            <a href="https://zalo.me/0900000000?text=T√¥i mu·ªën mua: ${p.name}" target="_blank" class="buy-btn">Mua ngay</a>
                        </div>
                    </div>
                `;
            });
        } catch (error) {
            loader.style.display = 'none';
            listContainer.innerHTML = "<p style='text-align:center; color:red;'>L·ªói k·∫øt n·ªëi d·ªØ li·ªáu!</p>";
            console.error(error);
        }
    }

    function closeShop(e) {
        if (e.target.id === 'shop-overlay') {
            document.getElementById('shop-overlay').style.display = 'none';
        }
    }
</script>
</body>
</html>
